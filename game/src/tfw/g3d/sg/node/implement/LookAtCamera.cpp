/***********************************************************************//**
 *  LookAtCamera.cpp
 *  Terras Framework
 *
 *  Created by Ryoutarou Kishi on 2010/04/16.
 *  Copyright 2010 Altoterras Corporation. All rights reserved.
 *
**//***********************************************************************/

////////////////////////////////////////////////////////////////////////////
// インクルードファイル

// Base

// Self
#include "LookAtCamera.h"

// Friends
#include "../../../../lib/Vector.h"
#include "../../../../gcmn/Gcalc.h"

// External

// Library

////////////////////////////////////////////////////////////////////////////

TFW_BEGIN_NS

////////////////////////////////////////////////////////////////////////////
// クラス

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// 外部サービス

/*---------------------------------------------------------------------*//**
	位置を設定する
**//*---------------------------------------------------------------------*/
void LookAtCamera::setLoc(const Vector3F* loc)
{
	_loc->copy(loc);
}

/*---------------------------------------------------------------------*//**
	注視点を設定する
**//*---------------------------------------------------------------------*/
void LookAtCamera::setAim(const Vector3F* aim)
{
	_aim->copy(aim);
}

/*---------------------------------------------------------------------*//**
	上方ベクトルを設定する
**//*---------------------------------------------------------------------*/
void LookAtCamera::setLookUp(const Vector3F* lup)
{
	_lup->copy(lup);
}

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// 内部制御

/*---------------------------------------------------------------------*//**
	コンストラクタ
**//*---------------------------------------------------------------------*/
LookAtCamera::LookAtCamera()
	: _loc(0L)
	, _aim(0L)
	, _lup(0L)
{
	_camclass = CAMCLS_LOOKAT;
}

/*---------------------------------------------------------------------*//**
	デストラクタ
**//*---------------------------------------------------------------------*/
LookAtCamera::~LookAtCamera()
{
	ASSERT(_loc == 0L);
	ASSERT(_aim == 0L);
	ASSERT(_lup == 0L);
}

/*---------------------------------------------------------------------*//**
	作成
**//*---------------------------------------------------------------------*/
bool LookAtCamera::create(f32 fovy, f32 cnear, f32 cfar, u16 flags)
{
	if(!Camera::create(fovy, cnear, cfar, flags))
	{
		return false;
	}

	_loc = new Vector3F();
	_aim = new Vector3F(0.0f, 0.0f, 100000.0f);	// デフォルトは Z 方向で遠くを見ている
	_lup = new Vector3F(0.0f, 1.0f, 0.0f);		// デフォルトは上向きに設定

	return true;
}

/*---------------------------------------------------------------------*//**
	破棄
**//*---------------------------------------------------------------------*/
void LookAtCamera::destroy()
{
	delete _lup;
	_lup = 0L;
	delete _aim;
	_aim = 0L;
	delete _loc;
	_loc = 0L;

	Camera::destroy();
}

/*---------------------------------------------------------------------*//**
	カメラ座標（ビュー座標）マトリックスの計算
**//*---------------------------------------------------------------------*/
void LookAtCamera::calcViewMatrix()
{
	// カメラの姿勢を計算する
	Gcalc::lookat( _mtxView, _loc, _aim, _lup );
}

////////////////////////////////////////////////////////////////////////////

TFW_END_NS